# https://circleci.com/blog/how-to-build-a-docker-image-on-circleci-2-0/
# https://circleci.com/docs/configuration-reference/#resourceclass
---
version: 2.1
jobs:
  build:
    working_directory: ~/app
    docker:
      - image: cimg/base:2024.07
    resource_class: arm.medium
    steps:
      - checkout
      - setup_remote_docker:
          docker_layer_caching: true
      - run:
          name: Run tests
          command: |
            uname -a; free -m; docker --version

      - run:
          name: "Runner storage cleanup"
          command: |
            ./.github/cleanup-runner.sh

      - run:
          name: "Build fedora-systemd image..."
          command: |
            docker build -t fedora_systemd:latest .

      - run:
          name: "Run Ansible in Docker..."
          command: |
            scripts/run_ansible_in_docker.sh
