---
- name: Check if installed on Fedora
  shell: |
    dnf list --installed | grep keybase
  register: keybase_dnf_installed
  changed_when: false
  ignore_errors: true
  args:
    warn: off
  when:
    - ansible_distribution == "Fedora"

- name: Check if installed on Ubuntu
  shell: |
    apt list --installed | grep keybase
  register: keybase_apt_installed
  changed_when: false
  ignore_errors: true
  args:
    warn: off
  when:
    - ansible_distribution == "Ubuntu"

- name: Install keybase on Fedora
  dnf:
    name: "https://prerelease.keybase.io/keybase_amd64.rpm"
    state: present
    disable_gpg_check: true
  when:
    - keybase_dnf_installed.rc != 0
    - ansible_distribution == "Fedora"

- name: Install keybase on Ubuntu
  apt:
    deb: "https://prerelease.keybase.io/keybase_amd64.deb"
    state: present
  when:
    - keybase_apt_installed.rc != 0
    - ansible_distribution == "Ubuntu"

- name: Run keybase
  shell: run_keybase
  args:
    creates: /keybase

# curl --remote-name https://prerelease.keybase.io/keybase_amd64.deb
# sudo apt install ./keybase_amd64.deb

# yum install https://prerelease.keybase.io/keybase_amd64.rpm
# run_keybase
