---
{% for i in home_assistant.mqtt.sonoff.temp_humidity %}
- name: th_temperature_{{ i.name }}
  state_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/{{ i.zigbee_id }}/SENSOR"
  value_template: >
    {% raw %}{% if value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['Temperature'] > 0 %}
      {% raw %}{{ value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['Temperature'] }}
    {% raw %}{% else %}
      {{ states(entity_id) }}
    {% endif %}{% endraw +%}
  availability_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/LWT"
  payload_available: "Online"
  payload_not_available: "Offline"
  qos: 0
  device_class: "temperature"
  expire_after: 86400
  unit_of_measurement: 'C'
- name: th_humidity_{{ i.name }}
  state_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/{{ i.zigbee_id }}/SENSOR"
  value_template: >
    {% raw %}{% if value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['Humidity'] > 0 %}
      {% raw %}{{ value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['Humidity'] }}
    {% raw %}{% else %}
      {{ states(entity_id) }}
    {% endif %}{% endraw +%}
  availability_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/LWT"
  payload_available: "Online"
  payload_not_available: "Offline"
  qos: 0
  device_class: "humidity"
  expire_after: 86400
  unit_of_measurement: '%'
- name: th_battery_percentage_{{ i.name }}
  state_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/{{ i.zigbee_id }}/SENSOR"
  value_template: >
    {% raw %}{% if value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['BatteryPercentage'] > 0 %}
      {% raw %}{{ value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['BatteryPercentage'] }}
    {% raw %}{% else %}
      {{ states(entity_id) }}
    {% endif %}{% endraw +%}
  availability_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/LWT"
  payload_available: "Online"
  payload_not_available: "Offline"
  qos: 0
  device_class: "battery"
  expire_after: 86400
  unit_of_measurement: '%'
- name: th_battery_voltage_{{ i.name }}
  state_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/{{ i.zigbee_id }}/SENSOR"
  value_template: >
    {% raw %}{% if value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['BatteryVoltage'] > 0 %}
      {% raw %}{{ value_json['ZbReceived']{% endraw %}['0x{{ i.zigbee_id }}']['BatteryVoltage'] }}
    {% raw %}{% else %}
      {{ states(entity_id) }}
    {% endif %}{% endraw +%}
  availability_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/LWT"
  payload_available: "Online"
  payload_not_available: "Offline"
  qos: 0
  device_class: "voltage"
  expire_after: 86400
{% endfor %}
