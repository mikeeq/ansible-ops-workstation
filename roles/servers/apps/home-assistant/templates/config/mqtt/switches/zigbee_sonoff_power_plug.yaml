---
# Sonoff S26R2ZB
# https://www.zigbee2mqtt.io/devices/S26R2ZB.html
{% for i in home_assistant.mqtt.sonoff.power_plug %}
- name: spp_{{ i.name }}
  state_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/spp_{{ i.name }}/SENSOR"
  value_template: >
    {% raw %}{{ value_json['ZbReceived']{% endraw %}['spp_{{ i.name }}']['Power'] }}
  state_on: 1
  state_off: 0
  command_topic: "cmnd/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/ZbSend"
  payload_on: >
    {"device": "spp_{{ i.name }}","send":{"Power":1}}
  payload_off: >
    {"device": "spp_{{ i.name }}","send":{"Power":0}}
  availability_topic: "tele/{{ home_assistant.mqtt.zigbee_coordinator_base_topic }}/LWT"
  payload_available: "Online"
  payload_not_available: "Offline"
  optimistic: false
  qos: 0
  retain: true
{% endfor %}

# MQTT call every 10s
# teleperiod 10

# 13:37:22.098 MQT: tele/tasmota_1AA4E8/STATE = {"Time":"2024-11-14T13:37:22","Uptime":"0T02:13:55","UptimeSec":8035,"Heap":22,"SleepMode":"Dynamic","Sleep":50,"LoadAvg":19,"MqttCount":2,"Wifi":{"AP":1,"SSId":"mikeeWifi","BSSId":"5C:02:14:B0:AA:AA","Channel":9,"Mode":"11n","RSSI":82,"Signal":-59,"LinkCount":1,"Downtime":"0T00:00:05"}}
# 13:37:22.110 MQT: tele/tasmota_1AA4E8/SENSOR = {"Time":"2024-11-14T13:37:22","DS18B20":{"Id":"0622A116FC5E","Temperature":33.2},"OPENTHERM":{"conn":"READY","settings":3,"SLAVE":{"FAULT":0,"CH":0,"DHW":1,"FL":1,"COOL":0,"CH2":0,"DIAG":0,"RAW":3221226252},"BTMP":{"FAULT":0,"REQ":58.0,"ACT": 58.0},"HWTMP":{"REQ":55.0,"ACT": 55.0},"ASFF":{"FC":0,"OFC":0},"FLM":0.0,"TB":62.7,"TDHW":49.5,"DHWS":55.0,"TMAX":80.0,"OT10":{"lo":0,"hi":0},"OT12":{"lo":0,"hi":0},"OT15":{"lo":34,"hi":0},"OT33":57,"OT116":49342,"OT120":7486},"TempUnit":"C"}

# {
#   "Time": "2024-11-14T13:37:22",
#   "Uptime": "0T02:13:55",
#   "UptimeSec": 8035,
#   "Heap": 22,
#   "SleepMode": "Dynamic",
#   "Sleep": 50,
#   "LoadAvg": 19,
#   "MqttCount": 2,
#   "Wifi": {
#     "AP": 1,
#     "SSId": "mikeeWifi",
#     "BSSId": "5C:02:14:B0:AA:AA",
#     "Channel": 9,
#     "Mode": "11n",
#     "RSSI": 82,
#     "Signal": -59,
#     "LinkCount": 1,
#     "Downtime": "0T00:00:05"
#   }
# }

# {
#   "Time": "2024-11-14T13:37:22",
#   "DS18B20": {
#     "Id": "0622A116FC5E",
#     "Temperature": 33.2
#   },
#   "OPENTHERM": {
#     "conn": "READY",
#     "settings": 3,
#     "SLAVE": {
#       "FAULT": 0,
#       "CH": 0,
#       "DHW": 1,
#       "FL": 1,
#       "COOL": 0,
#       "CH2": 0,
#       "DIAG": 0,
#       "RAW": 3221226252
#     },
#     "BTMP": {
#       "FAULT": 0,
#       "REQ": 58.0,
#       "ACT": 58.0
#     },
#     "HWTMP": {
#       "REQ": 55.0,
#       "ACT": 55.0
#     },
#     "ASFF": {
#       "FC": 0,
#       "OFC": 0
#     },
#     "FLM": 0.0,
#     "TB": 62.7,
#     "TDHW": 49.5,
#     "DHWS": 55.0,
#     "TMAX": 80.0,
#     "OT10": {
#       "lo": 0,
#       "hi": 0
#     },
#     "OT12": {
#       "lo": 0,
#       "hi": 0
#     },
#     "OT15": {
#       "lo": 34,
#       "hi": 0
#     },
#     "OT33": 57,
#     "OT116": 49342,
#     "OT120": 7486
#   },
#   "TempUnit": "C"
# }

# ot_tboiler 58
# ot_twater 55

# TDHW - temp w boilerze
# TB w piecu aktualnie
# FLM moc palnika
# ot33 ?
