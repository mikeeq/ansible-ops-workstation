---
- name: Check docker-compose executable is present
  shell: "which docker-compose"
  register: docker_compose_result
  ignore_errors: true
  changed_when: false

- fail:
    msg: "docker-compose is not found! You need to install it first."
  when: docker_compose_result.rc != 0

# - name: Ensure jenkins_home dir is removed (for tests)
#   file:
#     path: "{{ jenkins_home }}"
#     state: absent

# - name: Stop Jenkins using docker-compose (for tests)
#   command: docker-compose stop
#   changed_when: up_result.stderr_lines | length > 1
#   register: up_result
#   args:
#     chdir: "{{ jenkins_install_path }}"

- import_tasks: install-docker-compose.yml
- import_tasks: users.yml
- import_tasks: jjb.yml
