---
- name: Populate service facts
  ansible.builtin.service_facts:

- name: Disable and stop systemd-resolved
  ansible.builtin.service:
    name: systemd-resolved
    state: stopped
    enabled: false
  when: services['systemd-resolved.service'].status != "not-found"

- name: Set resolv.conf
  copy:
    content: |
      # Generated by NetworkManager
      nameserver 1.1.1.1
      nameserver 8.8.8.8
    dest: /etc/resolv.conf
    mode: 0644
    owner: root
    group: root
