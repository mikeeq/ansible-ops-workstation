---
- name: Directory temp for install script
  file:
    path: "{{ rpms_dwnl_path }}"
    state: directory

- name: oh-my-zsh deps
  package:
    name: "{{ pkgs }}"
    state: present
  vars:
    pkgs:
      - zsh
      - curl
      - git
      - fzf

- name: "Change user - {{ item }} - shell to zsh"
  user:
    name: "{{ item }}"
    shell: /bin/zsh
  with_items:
    - "{{ user_name }}"
    - root

- name: Download oh-my-zsh install script
  get_url:
    url: "https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh"
    dest: "{{ rpms_dwnl_path }}/install_oh_my_zsh.sh"
    force: true
    mode: 0755

- name: "oh-my-zsh install"
  become: true
  become_user: "{{ item }}"
  shell: |
    {{ rpms_dwnl_path }}/install_oh_my_zsh.sh
  args:
    creates: "~{{ item }}/.oh-my-zsh"
  with_items:
    - "{{ user_name }}"
    - root

- import_tasks: plugins.yml
- import_tasks: work.yml

- import_tasks: update.yml
  tags:
    - update
